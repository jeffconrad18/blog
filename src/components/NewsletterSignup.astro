---
---

<div class="newsletter-container mb-8 md:mb-8 lg:mb-8">
  <h3 class="text-4 font-bold mb-3">Newsletter abonnieren</h3>
  <p class="mb-3">Bleibe auf dem Laufenden über neue Beiträge und Updates.</p>
  
  <!-- Custom Form UI integrated with site design -->
  <form id="newsletter-form" class="flex flex-col gap-2" method="POST" action="https://ad03fcb2.sibforms.com/serve/MUIFAH0iC2JFbs0C5Dp_qvQc9FgW-T1FXD64mC0PV5yTY8rgZ9-sfolMRxP--EVqORlnkubrz0p8lhY6l7npSvVvH3iwl75Z_1IZPJbf_gs4llxzUS-_wANNHSBP1XK_bZCctMtVTCxQhjXg6ajI2Iazc1MmAYDWpLjm0GQ4_dx13vCWbgb_kVPcysOCl-qMnB6Yu0rf-0KebmBi">
    <input 
      type="email" 
      id="EMAIL" 
      name="EMAIL"
      placeholder="Deine E-Mail-Adresse" 
      required
      class="px-3 py-2 border rounded-md bg-transparent border-gray-400 dark:border-gray-600 w-full"
    >
    <input type="text" name="email_address_check" value="" class="input--hidden" style="display:none;">
    <input type="hidden" name="locale" value="de">
    <div class="button-message-container mt-2">
      <button 
        type="submit" 
        class="px-3 py-2 bg-primary text-white rounded-md hover:opacity-90 transition-opacity w-full"
      >
        Abonnieren
      </button>
      <div id="newsletter-message" class="hidden"></div>
    </div>
  </form>
</div>

<script>
  // Funktion zum Anzeigen von Nachrichten
  function showMessage(type: 'success' | 'error' | 'loading', message: string) {
    const messageEl = document.getElementById('newsletter-message');
    const submitButton = document.querySelector('#newsletter-form button[type="submit"]') as HTMLButtonElement;
    if (!messageEl || !submitButton) return;
    
    messageEl.textContent = message;
    messageEl.classList.remove('hidden');
    submitButton.classList.add('hidden');
    
    // Position des messageEl anpassen, um nicht mehr Platz als nötig einzunehmen
    messageEl.style.display = 'inline-block';
    
    // Alle Statusklassen entfernen
    messageEl.classList.remove('text-gray-500', 'text-green-500', 'text-red-500');
    
    // Die entsprechende Statusklasse hinzufügen
    switch(type) {
      case 'success':
        messageEl.classList.add('text-green-500');
        break;
      case 'error':
        messageEl.classList.add('text-red-500');
        break;
      case 'loading':
        messageEl.classList.add('text-gray-500');
        break;
    }
  }

  // Email-Input Event Listener hinzufügen
  document.getElementById('EMAIL')?.addEventListener('focus', function() {
    const submitButton = document.querySelector('#newsletter-form button[type="submit"]') as HTMLButtonElement;
    const messageEl = document.getElementById('newsletter-message');
    
    if (submitButton && submitButton.classList.contains('hidden')) {
      submitButton.classList.remove('hidden');
      if (messageEl) messageEl.classList.add('hidden');
    }
  });
  
  document.getElementById('newsletter-form')?.addEventListener('submit', function(e) {
    // Das Standard-Submit-Verhalten wird überschrieben
    e.preventDefault();
    
    const form = e.target as HTMLFormElement;
    const emailInput = form.elements.namedItem('EMAIL') as HTMLInputElement;
    const submitButton = document.querySelector('#newsletter-form button[type="submit"]') as HTMLButtonElement;
    const messageEl = document.getElementById('newsletter-message');
    
    // Validierung
    if (!emailInput.value) {
      showMessage('error', 'Bitte gib eine E-Mail-Adresse ein.');
      return;
    }
    
    showMessage('loading', 'Anmeldung wird verarbeitet...');
    
    // Submit per AJAX
    const formData = new FormData(form);
    
    fetch(form.action, {
      method: 'POST',
      body: formData,
      mode: 'no-cors' // Da Brevo möglicherweise CORS nicht unterstützt
    })
    .then(() => {
      // Da wir no-cors verwenden, können wir die Antwort nicht lesen
      // Wir nehmen an, dass alles gut gegangen ist
      showMessage('success', 'Anmeldung erfolgreich! Vielen Dank für dein Interesse.');
      emailInput.value = '';
      
      // Nach 5 Sekunden wieder den Button anzeigen
      setTimeout(() => {
        const submitButton = document.querySelector('#newsletter-form button[type="submit"]') as HTMLButtonElement;
        const messageEl = document.getElementById('newsletter-message');
        if (submitButton) submitButton.classList.remove('hidden');
        if (messageEl) {
          messageEl.classList.add('hidden');
          messageEl.style.display = 'none'; // Explizit auf none setzen, um Platz freizugeben
        }
      }, 5000);
    })
    .catch(error => {
      console.error('Fehler bei der Newsletter-Anmeldung:', error);
      showMessage('error', 'Es gab ein Problem bei der Anmeldung. Bitte versuche es später erneut.');
    });
  });
</script>

<style>
  .newsletter-container {
    padding: 1.5rem;
    border-radius: 0.5rem;
    background: var(--bg-secondary, rgba(0, 0, 0, 0.03));
    font-family: var(--font-navbar);
    line-height: 1.5;
    position: relative;
    z-index: 1;
  }

  input, button {
    font-family: var(--font-navbar);
  }

  button {
    white-space: nowrap;
  }
  
  .button-message-container {
    min-height: 40px;
    position: relative;
  }

  #newsletter-message {
    font-size: 0.9em;
    position: absolute;
    top: 8px;
  }

  .text-green-500 {
    color: #10b981;
  }

  .text-red-500 {
    color: #ef4444;
  }

  .text-gray-500 {
    color: #6b7280;
  }
</style>
