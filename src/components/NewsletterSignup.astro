---
---

<div class="newsletter-container mb-10">
  <h3 class="text-4 font-bold mb-3">Newsletter abonnieren</h3>
  <p class="mb-3">Bleibe auf dem Laufenden über neue Beiträge und Updates.</p>
  <form id="newsletter-form" class="flex flex-col gap-2 md:flex-row">
    <input 
      type="email" 
      id="email" 
      placeholder="Deine E-Mail-Adresse" 
      required
      class="px-3 py-2 border rounded-md bg-transparent border-gray-400 dark:border-gray-600 w-full md:w-auto flex-grow"
    >
    <button 
      type="submit" 
      class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90 transition-opacity"
    >
      Abonnieren
    </button>
  </form>
  <div id="newsletter-message" class="mt-2 hidden"></div>
</div>

<script>
  document.getElementById('newsletter-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const emailInput = document.getElementById('email') as HTMLInputElement;
    const email = emailInput.value;
    const messageEl = document.getElementById('newsletter-message');
    
    if (!messageEl) return;
    
    messageEl.textContent = "Anmeldung wird verarbeitet...";
    messageEl.classList.remove('hidden', 'text-green-500', 'text-red-500');
    messageEl.classList.add('text-gray-500');
    
    try {
      // Der GitHub-Token wird direkt auf GitHub als Repository Secret konfiguriert
      // und von einer Server-Komponente abgerufen oder über eine geschützte API
      const response = await fetch('/api/newsletter-signup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email })
      });
      
      if (response.ok || response.status === 204) {
        messageEl.textContent = "Anmeldung erfolgreich! Vielen Dank für dein Interesse.";
        messageEl.classList.remove('text-gray-500', 'text-red-500');
        messageEl.classList.add('text-green-500');
        emailInput.value = '';
      } else {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
    } catch (error) {
      console.error("Fehler bei der Newsletter-Anmeldung:", error);
      messageEl.textContent = "Es gab ein Problem bei der Anmeldung. Bitte versuche es später erneut.";
      messageEl.classList.remove('text-gray-500', 'text-green-500');
      messageEl.classList.add('text-red-500');
    }
    
    messageEl.classList.remove('hidden');
  });
</script>

<style>
  .newsletter-container {
    padding: 1.5rem;
    border-radius: 0.5rem;
    background: var(--bg-secondary, rgba(0, 0, 0, 0.03));
  }
</style>
